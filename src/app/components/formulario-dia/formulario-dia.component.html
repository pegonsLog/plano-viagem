<div class="formulario-overlay" (click)="onOverlayClick($event)">
  <div class="formulario-container" (click)="$event.stopPropagation()">
    <div class="formulario-header">
      <h3>{{ modoEdicao() ? 'Editar' : 'Adicionar' }} Detalhes do Dia</h3>
      <button class="btn-fechar" (click)="onCancelar()" type="button">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18" />
          <path d="M6 6l12 12" />
        </svg>
      </button>
    </div>

    <form [formGroup]="formulario" (ngSubmit)="onSubmit()" class="formulario-form">
      <!-- Data e Dia da Semana -->
      <div class="form-row">
        <div class="form-group">
          <label for="data">Data *</label>
          <input type="date" id="data" [(ngModel)]="dataString" (ngModelChange)="onDataChange()" required
            class="form-control">
          @if (dataString() === '') {
          <div class="error">Data √© obrigat√≥ria</div>
          }
        </div>
        <div class="form-group">
          <label>Dia da Semana</label>
          <div class="dia-semana-display" [class.fim-de-semana]="isFimDeSemana()">
            {{ diaSemanaCalculado() }}
          </div>
        </div>
      </div>

      <!-- Cidade -->
      <div class="form-group">
        <label for="cidade">Cidade *</label>
        <div class="input-with-button">
          <button type="button" class="btn-idem" (click)="copiarCidadeAnterior()" title="Copiar cidade do dia anterior">
            Idem
          </button>
        </div>
        <input type="text" id="cidade" formControlName="cidade" 
          placeholder="Ex: S√£o Paulo, SP" class="form-control">
        @if (formulario.get('cidade')?.invalid && formulario.get('cidade')?.touched) {
        <div class="error">Cidade √© obrigat√≥ria</div>
        }
      </div>

      <!-- Transporte -->
      <div class="form-group">
        <label for="transporte">Transporte *</label>
        <select id="transporte" formControlName="transporte" class="form-control">
          <option value="">Selecione o transporte</option>
          @for (tipo of tiposTransporte; track tipo.value) {
          <option [value]="tipo.value">{{ tipo.label }}</option>
          }
        </select>
        @if (formulario.get('transporte')?.invalid && formulario.get('transporte')?.touched) {
        <div class="error">Transporte √© obrigat√≥rio</div>
        }
      </div>

      <!-- Detalhes do Voo -->
      <div class="form-group">
        <label for="detalhesVoo">Detalhes do Voo</label>
        <textarea id="detalhesVoo" formControlName="detalhesVoo" rows="3"
          placeholder="Informa√ß√µes sobre voo, hor√°rios, companhia a√©rea" class="form-control">
        </textarea>
      </div>

      <!-- Hospedagem -->
      <div class="form-section">
        <h4>Hospedagem</h4>

        <!-- Nome da Hospedagem -->
        <div class="form-group">
          <label for="nomeHospedagem">Nome da Hospedagem *</label>
          <textarea id="nomeHospedagem" formControlName="nomeHospedagem"
            placeholder="Ex: Hotel Copacabana Palace" class="form-control" rows="2"></textarea>
          @if (formulario.get('nomeHospedagem')?.invalid && formulario.get('nomeHospedagem')?.touched) {
          <div class="error">Nome da hospedagem √© obrigat√≥rio</div>
          }
        </div>

        <!-- Endere√ßo da Hospedagem -->
        <div class="form-group">
          <label for="enderecoHospedagem">Endere√ßo da Hospedagem *</label>
          <textarea id="enderecoHospedagem" formControlName="enderecoHospedagem" rows="2"
            placeholder="Endere√ßo completo da hospedagem" class="form-control">
          </textarea>
          @if (formulario.get('enderecoHospedagem')?.invalid && formulario.get('enderecoHospedagem')?.touched) {
          <div class="error">Endere√ßo da hospedagem √© obrigat√≥rio</div>
          }
        </div>

        <!-- Contato da Hospedagem -->
        <div class="form-group">
          <label for="contatoHospedagem">Contato da Hospedagem</label>
          <textarea id="contatoHospedagem" formControlName="contatoHospedagem"
            placeholder="Telefone, email ou WhatsApp da hospedagem" class="form-control" rows="2"></textarea>
        </div>

        <!-- N√∫mero da Reserva -->
        <div class="form-group">
          <label for="numeroReserva">N√∫mero da Reserva</label>
          <textarea id="numeroReserva" formControlName="numeroReserva"
            placeholder="N√∫mero de confirma√ß√£o da reserva" class="form-control" rows="2"></textarea>
        </div>

        <!-- Hor√°rio Check-in/out -->
        <div class="form-group">
          <label for="horarioChecks">Hor√°rio Check-in/out</label>
          <textarea id="horarioChecks" formControlName="horarioChecks"
            placeholder="Ex: Check-in 15h, Check-out 11h" class="form-control" rows="2"></textarea>
        </div>

        <!-- Link da Hospedagem -->
        <div class="form-group">
          <label for="linkHospedagem">Link da Hospedagem</label>
          <div class="input-with-button">
            <button type="button" class="btn-idem" (click)="preencherIdem('linkHospedagem')" title="Copiar link do dia anterior">
              Idem
            </button>
          </div>
          <textarea id="linkHospedagem" formControlName="linkHospedagem" rows="3"
            placeholder="Links para acessar a acomoda√ß√£o (Booking, Airbnb, site do hotel, etc.)&#10;&#10;Exemplo:&#10;https://www.booking.com/hotel/br/copacabana-palace.html&#10;https://www.airbnb.com.br/rooms/12345" 
            class="form-control"></textarea>
          <div class="field-help">
            üí° Adicione um ou mais links separados por linha para facilitar o acesso direto √†s reservas
          </div>
        </div>
      </div>

      <!-- Deslocamento Local -->
      <div class="form-group">
        <label for="deslocamentoLocal">Deslocamento Local *</label>
        <textarea id="deslocamentoLocal" formControlName="deslocamentoLocal" rows="2"
          placeholder="Como se deslocar na cidade (Uber, metr√¥, √¥nibus, etc.)" class="form-control">
        </textarea>
        @if (formulario.get('deslocamentoLocal')?.invalid && formulario.get('deslocamentoLocal')?.touched) {
        <div class="error">Deslocamento local √© obrigat√≥rio</div>
        }
      </div>

      <!-- Observa√ß√µes -->
      <div class="form-group">
        <label for="observacoes">Observa√ß√µes</label>
        <textarea id="observacoes" formControlName="observacoes" rows="3"
          placeholder="Observa√ß√µes gerais sobre o dia" class="form-control">
        </textarea>
      </div>

      <!-- Pagamento -->
      <div class="form-section">
        <h4>Informa√ß√µes de Pagamento</h4>

        <!-- Forma de Pagamento -->
        <div class="form-group">
          <label for="formaPagamento">Forma de Pagamento *</label>
          <input type="text" id="formaPagamento" formControlName="formaPagamento"
            placeholder="Ex: Cart√£o de cr√©dito, dinheiro, PIX" class="form-control">
          @if (formulario.get('formaPagamento')?.invalid && formulario.get('formaPagamento')?.touched) {
          <div class="error">Forma de pagamento √© obrigat√≥ria</div>
          }
        </div>

        <!-- Titular do Cart√£o -->
        <div class="form-group">
          <label for="titularCartao">Titular do Cart√£o</label>
          <input type="text" id="titularCartao" formControlName="titularCartao"
            placeholder="Nome do titular do cart√£o" class="form-control">
        </div>

        <!-- Final do Cart√£o -->
        <div class="form-group">
          <label for="finalCartao">Final do Cart√£o</label>
          <input type="text" id="finalCartao" formControlName="finalCartao"
            placeholder="Ex: **** 1234" class="form-control">
        </div>

        <!-- Quantidade de Parcelas -->
        <div class="form-group">
          <label for="quantidadeParcelas">Quantidade de Parcelas</label>
          <input type="number" id="quantidadeParcelas" formControlName="quantidadeParcelas"
            placeholder="N√∫mero de parcelas" class="form-control" min="1">
        </div>
      </div>

      <!-- Bot√µes -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="onCancelar()">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="formulario.invalid || salvando()">
          @if (salvando()) {
          <span class="spinner"></span>
          }
          {{ modoEdicao() ? 'Atualizar' : 'Salvar' }}
        </button>
      </div>
    </form>
  </div>
</div>
