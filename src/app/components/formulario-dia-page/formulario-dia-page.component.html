<div class="formulario-page">
  <div class="page-header">
    <button class="btn-voltar" (click)="voltarParaViagem()" type="button">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5" />
        <path d="M12 19l-7-7 7-7" />
      </svg>
      Voltar
    </button>
    <h1>{{ modoEdicao() ? 'Editar' : 'Adicionar' }} Detalhes do Dia</h1>
  </div>

  <div class="formulario-container">
    <form [formGroup]="formulario" (ngSubmit)="onSubmit()" class="formulario-form">
      <!-- Data e Dia da Semana -->
      <div class="form-row">
        <div class="form-group">
          <label for="data">Data *</label>
          <input type="date" id="data" formControlName="data" (change)="onDataChange()" 
            class="form-control">
          @if (formulario.get('data')?.invalid && formulario.get('data')?.touched) {
          <div class="error">Data é obrigatória</div>
          }
        </div>

        <div class="form-group">
          <label for="diaSemana">Dia da Semana</label>
          <input type="text" id="diaSemana" name="diaSemana" [value]="diaSemanaCalculado()" readonly
            class="form-control readonly">
        </div>
      </div>

      <!-- Cidade -->
      <div class="form-group">
        <div class="form-label-with-button">
          <label for="cidade">Cidade *</label>
          <button type="button" class="btn-idem" (click)="preencherIdem('cidade')" title="Idem dia anterior">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12h18m-9-9l9 9-9 9" />
            </svg>
          </button>
        </div>
        <input type="text" id="cidade" formControlName="cidade" required
          placeholder="Ex: São Paulo, SP" class="form-control">
        @if (formulario.get('cidade')?.invalid && formulario.get('cidade')?.touched) {
        <div class="error">Cidade é obrigatória</div>
        }
      </div>

      <!-- Transporte -->
      <div class="form-group">
        <div class="form-label-with-button">
          <label for="transporte">Transporte</label>
          <button type="button" class="btn-idem-icon" (click)="preencherIdem('transporte')" title="Idem dia anterior">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12h18m-9-9l9 9-9 9" />
            </svg>
          </button>
        </div>
        <select id="transporte" formControlName="transporte" class="form-control">
          <option value="">Selecione o transporte</option>
          @for (tipo of tiposTransporte; track tipo.value) {
          <option [value]="tipo.value">{{ tipo.label }}</option>
          }
        </select>
      </div>

      <!-- Detalhes do Voo -->
      <div class="form-group">
        <div class="form-label-with-button">
          <label for="detalhesVoo">Detalhes do Voo</label>
          <button type="button" class="btn-idem-icon" (click)="preencherIdem('detalhesVoo')" title="Idem dia anterior">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12h18m-9-9l9 9-9 9" />
            </svg>
          </button>
        </div>
        <textarea id="detalhesVoo" formControlName="detalhesVoo" rows="3"
          placeholder="Ex: Voo TAM 3054, Saída: 14:30, Chegada: 16:45, Portão A12" class="form-control">
        </textarea>
      </div>

      <!-- Custo do Transporte -->
      <div class="form-group">
        <div class="form-label-with-button">
          <label for="custoTransporte">Custo do Transporte (R$)</label>
          <button type="button" class="btn-idem-icon" (click)="preencherIdem('custoTransporte')"
            title="Idem dia anterior">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12h18m-9-9l9 9-9 9" />
            </svg>
          </button>
        </div>
        <input type="number" id="custoTransporte" formControlName="custoTransporte"
          min="0" step="0.01" placeholder="Ex: 150.00" class="form-control">
        @if (formulario.get('custoTransporte')?.invalid && formulario.get('custoTransporte')?.touched) {
        <div class="error">Valor deve ser maior ou igual a zero</div>
        }
      </div>

      <!-- Hospedagem -->
      <div class="form-group">
        <div class="form-label-with-button">
          <label for="nomeHospedagem">Nome da Hospedagem</label>
          <button type="button" class="btn-idem-icon" (click)="preencherIdem('nomeHospedagem')"
            title="Idem dia anterior">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12h18m-9-9l9 9-9 9" />
            </svg>
          </button>
        </div>
        <textarea id="nomeHospedagem" formControlName="nomeHospedagem"
          placeholder="Ex: Hotel Copacabana Palace" class="form-control" rows="2"></textarea>
      </div>

      <div class="form-group">
        <div class="form-label-with-button">
          <label for="enderecoHospedagem">Endereço da Hospedagem</label>
          <button type="button" class="btn-idem-icon" (click)="preencherIdem('enderecoHospedagem')"
            title="Idem dia anterior">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12h18m-9-9l9 9-9 9" />
            </svg>
          </button>
        </div>
        <textarea id="enderecoHospedagem" formControlName="enderecoHospedagem" rows="2"
          placeholder="Endereço completo da hospedagem" class="form-control">
        </textarea>
      </div>

      <!-- Contato da Hospedagem -->
      <div class="form-group">
        <div class="form-label-with-button">
          <label for="contatoHospedagem">Contato da Hospedagem</label>
          <button type="button" class="btn-idem-icon" (click)="preencherIdem('contatoHospedagem')"
            title="Idem dia anterior">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12h18m-9-9l9 9-9 9" />
            </svg>
          </button>
        </div>
        <textarea id="contatoHospedagem" formControlName="contatoHospedagem"
          placeholder="Telefone, email ou WhatsApp da hospedagem" class="form-control" rows="2"></textarea>
      </div>

      <!-- Número da Reserva -->
      <div class="form-group">
        <div class="form-label-with-button">
          <label for="numeroReserva">Número da Reserva</label>
          <button type="button" class="btn-idem-icon" (click)="preencherIdem('numeroReserva')"
            title="Idem dia anterior">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12h18m-9-9l9 9-9 9" />
            </svg>
          </button>
        </div>
        <textarea id="numeroReserva" formControlName="numeroReserva"
          placeholder="Número de confirmação da reserva" class="form-control" rows="2"></textarea>
      </div>

      <!-- Horário Check-in/out -->
      <div class="form-group">
        <div class="form-label-with-button">
          <label for="horarioChecks">Horário Check-in/out</label>
          <button type="button" class="btn-idem-icon" (click)="preencherIdem('horarioChecks')"
            title="Idem dia anterior">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12h18m-9-9l9 9-9 9" />
            </svg>
          </button>
        </div>
        <textarea id="horarioChecks" formControlName="horarioChecks"
          placeholder="Ex: Check-in 15h, Check-out 11h" class="form-control" rows="2"></textarea>
      </div>

      <!-- Deslocamento Local -->
      <div class="form-group">
        <div class="form-label-with-button">
          <label for="deslocamentoLocal">Deslocamento Local</label>
          <button type="button" class="btn-idem-icon" (click)="preencherIdem('deslocamentoLocal')"
            title="Idem dia anterior">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12h18m-9-9l9 9-9 9" />
            </svg>
          </button>
        </div>
        <textarea id="deslocamentoLocal" formControlName="deslocamentoLocal" rows="2"
          placeholder="Como se deslocar pela cidade, pontos de interesse, etc." class="form-control">
        </textarea>
      </div>

      <!-- Observações -->
      <div class="form-group">
        <div class="form-label-with-button">
          <label for="observacoes">Observações</label>
          <button type="button" class="btn-idem-icon" (click)="preencherIdem('observacoes')" title="Idem dia anterior">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12h18m-9-9l9 9-9 9" />
            </svg>
          </button>
        </div>
        <textarea id="observacoes" formControlName="observacoes" rows="3"
          placeholder="Anotações adicionais, lembretes, etc." class="form-control">
        </textarea>
      </div>

      <!-- Informações de Pagamento -->
      <div class="form-section">
        <h4>Informações de Pagamento</h4>

        <div class="form-group">
          <div class="form-label-with-button">
            <label for="formaPagamento">Forma de Pagamento</label>
            <button type="button" class="btn-idem-icon" (click)="preencherIdem('formaPagamento')"
              title="Idem dia anterior">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 12h18m-9-9l9 9-9 9" />
              </svg>
            </button>
          </div>
          <input type="text" id="formaPagamento" formControlName="formaPagamento"
            placeholder="Ex: Cartão de Crédito, Dinheiro, PIX" class="form-control">
        </div>

        <div class="form-row">
          <div class="form-group">
            <div class="form-label-with-button">
              <label for="titularCartao">Titular do Cartão</label>
              <button type="button" class="btn-idem-icon" (click)="preencherIdem('titularCartao')"
                title="Idem dia anterior">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 12h18m-9-9l9 9-9 9" />
                </svg>
              </button>
            </div>
            <input type="text" id="titularCartao" formControlName="titularCartao"
              placeholder="Nome do titular" class="form-control">
          </div>

          <div class="form-group">
            <div class="form-label-with-button">
              <label for="finalCartao">Final do Cartão</label>
              <button type="button" class="btn-idem-icon" (click)="preencherIdem('finalCartao')"
                title="Idem dia anterior">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 12h18m-9-9l9 9-9 9" />
                </svg>
              </button>
            </div>
            <input type="text" id="finalCartao" formControlName="finalCartao"
              placeholder="Ex: 1234" maxlength="4" class="form-control">
          </div>
        </div>

        <div class="form-group">
          <div class="form-label-with-button">
            <label for="quantidadeParcelas">Quantidade de Parcelas</label>
            <button type="button" class="btn-idem-icon" (click)="preencherIdem('quantidadeParcelas')"
              title="Idem dia anterior">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 12h18m-9-9l9 9-9 9" />
              </svg>
            </button>
          </div>
          <input type="number" id="quantidadeParcelas" formControlName="quantidadeParcelas"
            min="1" max="24" placeholder="Ex: 3" class="form-control">
        </div>

        <div class="form-row">
          <div class="form-group">
            <div class="form-label-with-button">
              <label for="valorHospedagem">Valor da Hospedagem (R$)</label>
              <button type="button" class="btn-idem-icon" (click)="preencherIdem('valorHospedagem')"
                title="Idem dia anterior">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 12h18m-9-9l9 9-9 9" />
                </svg>
              </button>
            </div>
            <input type="number" id="valorHospedagem" formControlName="valorHospedagem"
              min="0" step="0.01" placeholder="Ex: 250.00" class="form-control">
            @if (formulario.get('valorHospedagem')?.invalid && formulario.get('valorHospedagem')?.touched) {
            <div class="error">Valor deve ser maior ou igual a zero</div>
            }
          </div>

          <div class="form-group">
            <div class="form-label-with-button">
              <label for="valorParcela">Valor da Parcela (R$)</label>
              <button type="button" class="btn-idem-icon" (click)="preencherIdem('valorParcela')"
                title="Idem dia anterior">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 12h18m-9-9l9 9-9 9" />
                </svg>
              </button>
            </div>
            <input type="text" id="valorParcela" formControlName="valorParcela" readonly
              placeholder="R$ 0,00" class="form-control readonly">
            @if (formulario.get('valorParcela')?.invalid && formulario.get('valorParcela')?.touched) {
            <div class="error">Valor deve ser maior ou igual a zero</div>
            }
          </div>
        </div>
      </div>

      <!-- Indicador de Fim de Semana -->
      @if (isFimDeSemana()) {
      <div class="fim-semana-notice">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10" />
          <path d="M12 6v6l4 2" />
        </svg>
        Este dia é um {{ diaSemanaCalculado().toLowerCase() }}
      </div>
      }

      <!-- Ações do Formulário -->
      <div class="form-actions">
        <button type="button" class="btn-cancelar" (click)="onCancelar()">
          Cancelar
        </button>
        <button type="submit" class="btn-salvar" [disabled]="formulario.invalid || salvando()">
          @if (salvando()) {
          <svg class="spinner" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2">
            <path d="M21 12a9 9 0 11-6.219-8.56" />
          </svg>
          }
          {{ modoEdicao() ? 'Atualizar' : 'Salvar' }}
        </button>
      </div>
    </form>
  </div>
</div>