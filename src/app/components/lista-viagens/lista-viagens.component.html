<div class="lista-viagens">
  <div class="header">
    <h2>Minhas Viagens</h2>
    <button class="btn-adicionar" (click)="mostrarFormulario = !mostrarFormulario; viagemParaEditar = null">
      {{ mostrarFormulario ? 'Cancelar' : 'Nova Viagem' }}
    </button>
  </div>

  @if (mostrarFormulario) {
  <app-formulario-viagem [viagemParaEditar]="viagemParaEditar" (viagemCriada)="onViagemCriada()"
    (viagemAtualizada)="onViagemAtualizada()" (cancelar)="onCancelar()">
  </app-formulario-viagem>
  }

  @if (viagemService.loading()) {
  <div class="loading-state">
    <div class="spinner"></div>
    <p>Carregando viagens...</p>
  </div>
  }

  <div class="viagens-grid">
    @for (viagem of viagemService.viagens(); track viagem.id) {
    <div class="viagem-card clickable" [class]="'status-' + viagem.status" (click)="verDetalhesViagem(viagem.id)">
      <div class="viagem-header">
        <div class="titulo-container">
          <h3>{{ viagem.titulo }}</h3>
          <span class="clique-detalhes">Clique para ver detalhes</span>
        </div>
        <div class="status-badges">
          <span class="status-badge">{{ getStatusLabel(viagem.status) }}</span>
          @if (viagem.temPendencia) {
          <span class="status-badge pendencia" [title]="viagem.motivoPendencia || 'Pendência sem motivo especificado'">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" />
              <path d="M12 8v4l3 3" />
            </svg>
            Pendente
          </span>
          } @else {
          <span class="status-badge concluido">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12l2 2 4-4" />
              <circle cx="12" cy="12" r="10" />
            </svg>
            Concluído
          </span>
          }
          <div class="seta-navegacao">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="m9 18 6-6-6-6" />
            </svg>
          </div>
        </div>
      </div>

      <div class="viagem-info">
        <p><strong>Destino:</strong> {{ viagem.destino }}</p>
        <p><strong>Data:</strong> {{ formatarData(viagem.dataInicio) }} - {{ formatarData(viagem.dataFim) }}</p>
        <p><strong>Orçamento:</strong> {{ formatarMoeda(viagem.orcamento) }}</p>
        @if (viagem.descricao) {
        <p><strong>Descrição:</strong> {{ viagem.descricao }}</p>
        }
        @if (viagem.lembretesImportantes) {
        <div class="campo-multiline">
          <strong>Lembretes:</strong>
          <div class="preserve-lines">{{ viagem.lembretesImportantes }}</div>
        </div>
        }
        @if (viagem.temPendencia && viagem.motivoPendencia) {
        <div class="campo-multiline">
          <strong>Motivo da Pendência:</strong>
          <div class="preserve-lines pendencia-text">{{ viagem.motivoPendencia }}</div>
        </div>
        }
      </div>

      <div class="viagem-acoes" (click)="$event.stopPropagation()">
        <button class="btn-tabela" (click)="verTabelaDias(viagem.id)" title="Ver dias planejados">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
            <line x1="9" y1="9" x2="15" y2="9" />
            <line x1="9" y1="15" x2="15" y2="15" />
          </svg>
          Tabela
        </button>
        <button class="btn-relatorio" (click)="verRelatorio(viagem.id)" title="Ver relatório da viagem">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
            <polyline points="14,2 14,8 20,8" />
            <line x1="16" y1="13" x2="8" y2="13" />
            <line x1="16" y1="17" x2="8" y2="17" />
            <polyline points="10,9 9,9 8,9" />
          </svg>
          Relatório
        </button>
        <button class="btn-editar" (click)="editarViagem(viagem)">Editar</button>
        <button class="btn-remover" (click)="removerViagem(viagem.id)">Remover</button>
      </div>
    </div>
    } @empty {
    <div class="empty-state">
      <p>Nenhuma viagem cadastrada ainda.</p>
      <p>Clique em "Nova Viagem" para começar!</p>
    </div>
    }
  </div>
</div>