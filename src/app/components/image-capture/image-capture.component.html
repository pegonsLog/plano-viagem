@if (isOpen()) {
<div class="modal-overlay" (click)="close()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>
        <app-icon name="camera" [size]="24"></app-icon>
        {{ isMobile() ? 'Capturar Foto' : 'Adicionar Imagem' }}
      </h3>
      <button class="btn-close" (click)="close()">
        <app-icon name="x-mark" [size]="24"></app-icon>
      </button>
    </div>

    <div class="modal-body">
      @if (error()) {
        <div class="error-message">
          <app-icon name="exclamation-circle" [size]="20"></app-icon>
          {{ error() }}
        </div>
      }

      @if (!previewUrl()) {
        @if (isMobile()) {
          <div class="capture-options">
            <label class="capture-btn camera">
              <app-icon name="camera" [size]="32"></app-icon>
              <span>Tirar Foto</span>
              <input type="file" accept="image/*" capture="environment" (change)="onFileSelected($event)" hidden />
            </label>
            <label class="capture-btn gallery">
              <app-icon name="photo" [size]="32"></app-icon>
              <span>Galeria</span>
              <input type="file" accept="image/*" (change)="onFileSelected($event)" hidden />
            </label>
          </div>
        } @else {
          <div class="drop-zone" 
               (drop)="onDrop($event)" 
               (dragover)="onDragOver($event)"
               (dragleave)="$event.preventDefault()">
            <app-icon name="cloud-arrow-up" [size]="48" color="#6366f1"></app-icon>
            <p>Arraste uma imagem aqui</p>
            <span>ou</span>
            <label class="btn-select-file">
              <app-icon name="folder-open" [size]="20"></app-icon>
              Selecionar arquivo
              <input type="file" accept="image/*" (change)="onFileSelected($event)" hidden />
            </label>
            <small>Formatos: JPG, PNG, GIF (máx. 10MB)</small>
          </div>
        }
      } @else {
        <div class="preview-container">
          <img [src]="previewUrl()" alt="Preview" class="preview-image" />
          <button class="btn-remove-preview" (click)="removePreview()">
            <app-icon name="x-mark" [size]="20"></app-icon>
          </button>
        </div>

        <div class="form-fields">
          <div class="form-group">
            <label for="fotoData">
              <app-icon name="calendar" [size]="16"></app-icon>
              Data da Foto
            </label>
            <input 
              type="date" 
              id="fotoData" 
              [value]="fotoData()" 
              (input)="updateData($any($event.target).value)" 
            />
          </div>
          
          <div class="form-group">
            <label for="fotoDescricao">
              <app-icon name="document-text" [size]="16"></app-icon>
              Descrição
            </label>
            <textarea 
              id="fotoDescricao" 
              [value]="fotoDescricao()" 
              (input)="updateDescricao($any($event.target).value)"
              placeholder="Descreva este momento..."
              rows="3"
            ></textarea>
          </div>
        </div>
      }
    </div>

    <div class="modal-footer">
      <button class="btn-cancel" (click)="close()" [disabled]="uploading()">
        Cancelar
      </button>
      <button class="btn-upload" (click)="uploadImage()" [disabled]="!selectedFile() || uploading()">
        @if (uploading()) {
          <span class="spinner"></span>
          Enviando...
        } @else {
          <app-icon name="cloud-arrow-up" [size]="20"></app-icon>
          Salvar Imagem
        }
      </button>
    </div>
  </div>
</div>
}
