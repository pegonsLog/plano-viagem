<div class="tabela-page">
    <div class="page-header">
        <button class="btn-voltar" (click)="voltarParaViagem()" type="button">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5" />
                <path d="M12 19l-7-7 7-7" />
            </svg>
            Voltar
        </button>
        <h1>Dias Planejados - {{ viagem()?.titulo || 'Carregando...' }}</h1>
    </div>

    <div class="tabela-container">
        @if (loading()) {
        <div class="loading">
            <svg class="spinner" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <path d="M21 12a9 9 0 11-6.219-8.56" />
            </svg>
            Carregando dias...
        </div>
        } @else {
        <div class="tabela-wrapper">
            <table class="tabela-dias">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Dia da Semana</th>
                        <th>Cidade</th>
                        <th>Transporte</th>
                        <th>Hospedagem</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    @for (diaCalculado of diasCalculados(); track diaCalculado.data.getTime()) {
                    <tr
                        [class.fim-semana]="diaCalculado.diaSemana === 'Sábado' || diaCalculado.diaSemana === 'Domingo'">
                        <td class="data">{{ formatarData(diaCalculado.data) }}</td>
                        <td class="dia-semana">{{ diaCalculado.diaSemana }}</td>
                        <td class="cidade">
                            @if (diaCalculado.detalhes && diaCalculado.detalhes.cidade) {
                            {{ diaCalculado.detalhes.cidade }}
                            } @else {
                            <span class="sem-dados">-</span>
                            }
                        </td>
                        <td class="transporte">
                            @if (diaCalculado.detalhes && diaCalculado.detalhes.transporte) {
                            {{ diaCalculado.detalhes.transporte }}
                            } @else {
                            <span class="sem-dados">-</span>
                            }
                        </td>
                        <td class="hospedagem">
                            @if (diaCalculado.detalhes && diaCalculado.detalhes.nomeHospedagem) {
                            {{ diaCalculado.detalhes.nomeHospedagem }}
                            } @else {
                            <span class="sem-dados">-</span>
                            }
                        </td>
                        <td class="status">
                            @if (diaCalculado.temDetalhes) {
                            <span class="badge completo">Completo</span>
                            } @else {
                            <span class="badge pendente">Pendente</span>
                            }
                        </td>
                        <td class="acoes">
                            @if (diaCalculado.temDetalhes) {
                            <button class="btn-acao editar" (click)="editarDia(diaCalculado.detalhes!.id)"
                                title="Editar detalhes">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                                </svg>
                            </button>
                            <button class="btn-acao visualizar" (click)="visualizarDetalhes(diaCalculado.detalhes!)"
                                title="Ver detalhes">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                                    <circle cx="12" cy="12" r="3" />
                                </svg>
                            </button>
                            } @else {
                            <button class="btn-acao adicionar" (click)="adicionarDia(diaCalculado.data)"
                                title="Adicionar detalhes">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M12 5v14" />
                                    <path d="M5 12h14" />
                                </svg>
                            </button>
                            }
                        </td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>

        @if (diasCalculados().length === 0) {
        <div class="sem-dados-container">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                <line x1="16" y1="2" x2="16" y2="6" />
                <line x1="8" y1="2" x2="8" y2="6" />
                <line x1="3" y1="10" x2="21" y2="10" />
            </svg>
            <h3>Nenhum dia encontrado</h3>
            <p>Não há dias planejados para esta viagem.</p>
        </div>
        }
        }
    </div>
</div>

<!-- Modal de Detalhes -->
@if (diaDetalhes()) {
<div class="modal-overlay" (click)="fecharDetalhes()">
    <div class="modal-container" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3>Detalhes do Dia - {{ formatarData(diaDetalhes()!.data) }}</h3>
            <button class="btn-fechar" (click)="fecharDetalhes()" type="button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18" />
                    <path d="M6 6l12 12" />
                </svg>
            </button>
        </div>

        <div class="modal-content">
            <div class="detalhes-grid">
                <div class="detalhe-item">
                    <label>Cidade:</label>
                    <span>{{ diaDetalhes()!.cidade }}</span>
                </div>

                @if (diaDetalhes()!.transporte) {
                <div class="detalhe-item">
                    <label>Transporte:</label>
                    <span>{{ diaDetalhes()!.transporte }}</span>
                </div>
                }

                @if (diaDetalhes()!.detalhesVoo) {
                <div class="detalhe-item full-width">
                    <label>Detalhes do Voo:</label>
                    <span>{{ diaDetalhes()!.detalhesVoo }}</span>
                </div>
                }

                @if (diaDetalhes()!.nomeHospedagem) {
                <div class="detalhe-item">
                    <label>Hospedagem:</label>
                    <span>{{ diaDetalhes()!.nomeHospedagem }}</span>
                </div>
                }

                @if (diaDetalhes()!.enderecoHospedagem) {
                <div class="detalhe-item full-width">
                    <label>Endereço:</label>
                    <span>{{ diaDetalhes()!.enderecoHospedagem }}</span>
                </div>
                }

                @if (diaDetalhes()!.contatoHospedagem) {
                <div class="detalhe-item full-width">
                    <label>Contato Hospedagem:</label>
                    <span class="preserve-lines">{{ diaDetalhes()!.contatoHospedagem }}</span>
                </div>
                }

                @if (diaDetalhes()!.numeroReserva) {
                <div class="detalhe-item full-width">
                    <label>Número da Reserva:</label>
                    <span class="preserve-lines">{{ diaDetalhes()!.numeroReserva }}</span>
                </div>
                }

                @if (diaDetalhes()!.horarioChecks) {
                <div class="detalhe-item full-width">
                    <label>Horário Check-in/out:</label>
                    <span class="preserve-lines">{{ diaDetalhes()!.horarioChecks }}</span>
                </div>
                }

                @if (diaDetalhes()!.deslocamentoLocal) {
                <div class="detalhe-item full-width">
                    <label>Deslocamento Local:</label>
                    <span>{{ diaDetalhes()!.deslocamentoLocal }}</span>
                </div>
                }

                @if (diaDetalhes()!.observacoes) {
                <div class="detalhe-item full-width">
                    <label>Observações:</label>
                    <span>{{ diaDetalhes()!.observacoes }}</span>
                </div>
                }

                @if (diaDetalhes()!.formaPagamento) {
                <div class="detalhe-item">
                    <label>Forma de Pagamento:</label>
                    <span>{{ diaDetalhes()!.formaPagamento }}</span>
                </div>
                }

                @if (diaDetalhes()!.titularCartao) {
                <div class="detalhe-item">
                    <label>Titular do Cartão:</label>
                    <span>{{ diaDetalhes()!.titularCartao }}</span>
                </div>
                }

                @if (diaDetalhes()!.finalCartao) {
                <div class="detalhe-item">
                    <label>Final do Cartão:</label>
                    <span>{{ diaDetalhes()!.finalCartao }}</span>
                </div>
                }

                @if (diaDetalhes()!.quantidadeParcelas) {
                <div class="detalhe-item">
                    <label>Parcelas:</label>
                    <span>{{ diaDetalhes()!.quantidadeParcelas }}x</span>
                </div>
                }
            </div>
        </div>
    </div>
</div>
}